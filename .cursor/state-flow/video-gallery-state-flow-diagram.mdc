---
alwaysApply: false
---

# ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒíƒœ íë¦„ ë‹¤ì´ì–´ê·¸ë¨ (API í¬í•¨)

## ğŸ“‹ ê°œìš”

ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ëŠ” ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œì˜ í•µì‹¬ ì—”í‹°í‹°ë¡œ, **ìƒíƒœ(Status)**ì™€ **ê³µê°œ ì—¬ë¶€(isPublic)** ë‘ ê°€ì§€ ì°¨ì›ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.
ë¹„ë””ì˜¤ ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ë©°, ë‹¤êµ­ì–´ë¥¼ ì§€ì›í•˜ì§€ ì•Šê³  ë‹¨ì¼ ì–¸ì–´(í•œêµ­ì–´)ë¡œë§Œ ì‘ì„±ë©ë‹ˆë‹¤.

## ğŸ”„ ìƒíƒœ(Status) ì •ì˜

| ìƒíƒœ       | ê°’             | ì„¤ëª…                              |
| ---------- | -------------- | --------------------------------- |
| **ì´ˆì•ˆ**   | `draft`        | ì‘ì„± ì¤‘ì¸ ìƒíƒœ, ì•„ì§ ê²€í†  ìš”ì²­ ì „ |
| **ê²€í† ì¤‘** | `under_review` | ê²€í†  ìš”ì²­ í›„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘         |
| **ìŠ¹ì¸ë¨** | `approved`     | ê²€í†  ì™„ë£Œ, ìŠ¹ì¸ëœ ìƒíƒœ            |
| **ê±°ë¶€ë¨** | `rejected`     | ê²€í†  ê²°ê³¼ ê±°ë¶€ëœ ìƒíƒœ             |
| **ê³µê°œë¨** | `opened`       | ìµœì¢… ê³µê°œëœ ìƒíƒœ                  |

## ğŸ“Š ìƒíƒœ ì „ì´ ë‹¤ì´ì–´ê·¸ë¨ (API í¬í•¨)

```mermaid
stateDiagram-v2
    [*] --> draft: ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„±

    draft --> under_review: ê²€í†  ìš”ì²­ (êµ¬í˜„ í•„ìš”)
    draft --> draft: ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥

    under_review --> approved: ìŠ¹ì¸ (êµ¬í˜„ í•„ìš”)
    under_review --> rejected: ê±°ë¶€ (êµ¬í˜„ í•„ìš”)
    under_review --> draft: ê²€í†  ì·¨ì†Œ (êµ¬í˜„ í•„ìš”)

    approved --> opened: ê³µê°œ ì„¤ì • (êµ¬í˜„ í•„ìš”)
    approved --> draft: ìˆ˜ì • ì‹œì‘ (êµ¬í˜„ í•„ìš”)

    rejected --> draft: ìˆ˜ì • ì‹œì‘ (êµ¬í˜„ í•„ìš”)

    opened --> draft: ìˆ˜ì • ì‹œì‘
    opened --> opened: ë¹„ê³µê°œ ì„¤ì •

    note right of draft
        ì´ˆì•ˆ ìƒíƒœ
        ëª¨ë“  ìˆ˜ì • ê°€ëŠ¥
        ë¹„ë””ì˜¤ ì¶”ê°€/ìˆ˜ì • ê°€ëŠ¥
    end note

    note right of under_review
        ê²€í† ì¤‘ ìƒíƒœ
        ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€
    end note

    note right of approved
        ìŠ¹ì¸ë¨ ìƒíƒœ
        ê³µê°œ ì¤€ë¹„ ì™„ë£Œ
    end note

    note right of rejected
        ê±°ë¶€ë¨ ìƒíƒœ
        ìˆ˜ì • í•„ìš”
    end note

    note right of opened
        ê³µê°œë¨ ìƒíƒœ
        ì‚¬ìš©ì ë…¸ì¶œ
    end note
```

### ğŸ”— ìƒíƒœ ì „ì´ì™€ API ë§¤í•‘

| ìƒíƒœ ì „ì´               | ì•¡ì…˜              | API ì—”ë“œí¬ì¸íŠ¸                                                                                                                                                                      | êµ¬í˜„ ìƒíƒœ |
| ----------------------- | ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| **[ìƒì„±]** â†’ draft      | ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„± | `POST /api/admin/video-galleries`                                                                                                                                                   | âœ…        |
| draft â†’ under_review    | ê²€í†  ìš”ì²­         | `PATCH /api/admin/video-galleries/:id/status` (êµ¬í˜„ í•„ìš”)                                                                                                                           | âŒ        |
| draft â†’ draft           | ìˆ˜ì •/ì‚­ì œ         | `PUT /api/admin/video-galleries/:id`<br/>`PATCH /api/admin/video-galleries/:id/public`<br/>`PUT /api/admin/video-galleries/batch-order`<br/>`DELETE /api/admin/video-galleries/:id` | âœ…        |
| under_review â†’ approved | ìŠ¹ì¸              | `PATCH /api/admin/video-galleries/:id/status` (êµ¬í˜„ í•„ìš”)                                                                                                                           | âŒ        |
| under_review â†’ rejected | ê±°ë¶€              | `PATCH /api/admin/video-galleries/:id/status` (êµ¬í˜„ í•„ìš”)                                                                                                                           | âŒ        |
| under_review â†’ draft    | ê²€í†  ì·¨ì†Œ         | `PATCH /api/admin/video-galleries/:id/status` (êµ¬í˜„ í•„ìš”)                                                                                                                           | âŒ        |
| approved â†’ opened       | ê³µê°œ ì„¤ì •         | `PATCH /api/admin/video-galleries/:id/status` (êµ¬í˜„ í•„ìš”)                                                                                                                           | âŒ        |
| approved â†’ draft        | ìˆ˜ì • ì‹œì‘         | `PUT /api/admin/video-galleries/:id` (ìë™ ìƒíƒœ ì „ì´, êµ¬í˜„ í•„ìš”)                                                                                                                    | âŒ        |
| rejected â†’ draft        | ìˆ˜ì • ì‹œì‘         | `PATCH /api/admin/video-galleries/:id/status` (êµ¬í˜„ í•„ìš”)                                                                                                                           | âŒ        |
| opened â†’ draft          | ìˆ˜ì • ì‹œì‘         | `PUT /api/admin/video-galleries/:id` (ìë™ ìƒíƒœ ì „ì´, êµ¬í˜„ í•„ìš”)                                                                                                                    | âŒ        |
| opened â†’ opened         | ë¹„ê³µê°œ ì„¤ì •       | `PATCH /api/admin/video-galleries/:id/public`                                                                                                                                       | âœ…        |

## ğŸŒ ì „ì²´ API ì—”ë“œí¬ì¸íŠ¸ ë§µ

### ìƒíƒœì™€ ë¬´ê´€í•œ ì¡°íšŒ API

```mermaid
graph LR
    A[ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ API] --> B[GET /video-galleries]
    A --> C[GET /video-galleries/all]
    A --> D[GET /video-galleries/:id]
    A --> E[GET /video-galleries/categories]

    B --> B1[ëª©ë¡ ì¡°íšŒ í˜ì´ì§•]
    C --> C1[ì „ì²´ ëª©ë¡]
    D --> D1[ìƒì„¸ ì¡°íšŒ]
    E --> E1[ì¹´í…Œê³ ë¦¬ ëª©ë¡]
```

### ìƒíƒœë³„ ê°€ëŠ¥í•œ API ì•¡ì…˜

```mermaid
graph TD
    subgraph DRAFT["DRAFT ì´ˆì•ˆ"]
        D1[POST ìƒì„± âœ…]
        D2[PUT ìˆ˜ì • âœ…]
        D3[PATCH public âœ…]
        D4[PUT batch-order âœ…]
        D5[DELETE ì‚­ì œ âœ…]
        D6[ë¹„ë””ì˜¤ ì¶”ê°€/ìˆ˜ì • âœ…]
        D7[PATCH status â†’ UNDER_REVIEW âŒ]
    end

    subgraph UNDER_REVIEW["UNDER_REVIEW ê²€í† ì¤‘ êµ¬í˜„ í•„ìš”"]
        U1[GET ì¡°íšŒë§Œ ê°€ëŠ¥]
        U2[PATCH status â†’ APPROVED âŒ]
        U3[PATCH status â†’ REJECTED âŒ]
        U4[PATCH status â†’ DRAFT âŒ]
    end

    subgraph APPROVED["APPROVED ìŠ¹ì¸ë¨ êµ¬í˜„ í•„ìš”"]
        A1[GET ì¡°íšŒ]
        A2[PATCH status â†’ OPENED âŒ]
        A3[PATCH public âœ…]
        A4[PUT ìˆ˜ì • â†’ DRAFT ì „ì´ âŒ]
        A5[DELETE ì‚­ì œ âœ…]
    end

    subgraph REJECTED["REJECTED ê±°ë¶€ë¨ êµ¬í˜„ í•„ìš”"]
        R1[GET ì¡°íšŒ]
        R2[PATCH status â†’ DRAFT âŒ]
        R3[DELETE ì‚­ì œ âœ…]
    end

    subgraph OPENED["OPENED ê³µê°œë¨"]
        O1[GET ì¡°íšŒ]
        O2[PATCH public âœ…]
        O3[PUT ìˆ˜ì • â†’ DRAFT ì „ì´ âŒ]
        O4[DELETE ì‚­ì œ âœ…]
    end

    style DRAFT fill:#e3f2fd
    style UNDER_REVIEW fill:#fff3e0
    style APPROVED fill:#e8f5e9
    style REJECTED fill:#ffebee
    style OPENED fill:#f3e5f5
```

## ğŸ”„ ìƒíƒœ ì „ì´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒì ì¸ ê³µê°œ í”„ë¡œì„¸ìŠ¤

```mermaid
sequenceDiagram
    participant Admin as ê´€ë¦¬ì
    participant API as API ì„œë²„
    participant DB as ë°ì´í„°ë² ì´ìŠ¤
    participant S3 as S3 Storage

    Note over Admin,S3: 1. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„±
    Admin->>API: POST /api/admin/video-galleries
    API->>S3: Upload video files
    S3-->>API: S3 URLs
    API->>DB: INSERT (status: 'draft', isPublic: false)
    Note right of DB: videoSources: [{url, type}]
    DB-->>API: ìƒì„± ì™„ë£Œ
    API-->>Admin: 201 Created (DRAFT)

    Note over Admin,S3: 2. ë¹„ë””ì˜¤ ë° ë‚´ìš© ìˆ˜ì •
    Admin->>API: PUT /api/admin/video-galleries/:id
    API->>S3: Upload new videos
    S3-->>API: New S3 URLs
    API->>DB: UPDATE title, description, videoSources
    DB-->>API: ìˆ˜ì • ì™„ë£Œ
    API-->>Admin: 200 OK

    Note over Admin,S3: 3. ê²€í†  ìš”ì²­ (êµ¬í˜„ í•„ìš”)
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: {status: 'under_review'}
    API->>DB: UPDATE status = 'under_review'
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (UNDER_REVIEW)

    Note over Admin,S3: 4. ìŠ¹ì¸ (êµ¬í˜„ í•„ìš”)
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: {status: 'approved'}
    API->>DB: UPDATE status = 'approved'
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (APPROVED)

    Note over Admin,S3: 5. ê³µê°œ ì„¤ì • (êµ¬í˜„ í•„ìš”)
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: {status: 'opened'}
    API->>DB: UPDATE status = 'opened'
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (OPENED)

    Note over Admin,S3: 6. ê³µê°œ ì—¬ë¶€ í™œì„±í™”
    Admin->>API: PATCH /api/admin/video-galleries/:id/public
    Note right of API: {isPublic: true}
    API->>DB: UPDATE isPublic = true
    DB-->>API: ìˆ˜ì • ì™„ë£Œ
    API-->>Admin: 200 OK

    Note over Admin,S3: âœ… ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë¨
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ê±°ë¶€ í›„ ì¬ê²€í† 

```mermaid
sequenceDiagram
    participant Admin as ê´€ë¦¬ì
    participant API as API ì„œë²„
    participant DB as ë°ì´í„°ë² ì´ìŠ¤

    Note over Admin,DB: 1-3. ìƒì„± â†’ ê²€í†  ìš”ì²­ (ìƒëµ)

    Note over Admin,DB: 4. ê±°ë¶€ (êµ¬í˜„ í•„ìš”)
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: {status: 'rejected'}
    API->>DB: UPDATE status = 'rejected'
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (REJECTED)

    Note over Admin,DB: 5. ìˆ˜ì • ì‹œì‘ (êµ¬í˜„ í•„ìš”)
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: {status: 'draft'}
    API->>DB: UPDATE status = 'draft'
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (DRAFT)

    Note over Admin,DB: 6. ë‚´ìš© ìˆ˜ì •
    Admin->>API: PUT /api/admin/video-galleries/:id
    API->>DB: UPDATE title, description, videoSources
    DB-->>API: ìˆ˜ì • ì™„ë£Œ
    API-->>Admin: 200 OK

    Note over Admin,DB: 7. ì¬ê²€í†  ìš”ì²­ (êµ¬í˜„ í•„ìš”)
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: {status: 'under_review'}
    API->>DB: UPDATE status = 'under_review'
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (UNDER_REVIEW)

    Note over Admin,DB: 8-10. ìŠ¹ì¸ â†’ ê³µê°œ (ìƒëµ)
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ê³µê°œëœ ì½˜í…ì¸  ìˆ˜ì • (êµ¬í˜„ í•„ìš”)

```mermaid
sequenceDiagram
    participant Admin as ê´€ë¦¬ì
    participant API as API ì„œë²„
    participant DB as ë°ì´í„°ë² ì´ìŠ¤
    participant User as ì‚¬ìš©ì

    Note over Admin,User: âœ… í˜„ì¬ ê³µê°œ ì¤‘ (OPENED, isPublic: true)
    User->>API: GET /api/public/video-galleries
    API->>DB: SELECT WHERE status='opened' AND isPublic=true
    DB-->>API: ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ëª©ë¡
    API-->>User: 200 OK (ë…¸ì¶œë¨)

    Note over Admin,User: ìˆ˜ì • í•„ìš” ë°œìƒ (ìë™ ìƒíƒœ ì „ì´, êµ¬í˜„ í•„ìš”)
    Admin->>API: PUT /api/admin/video-galleries/:id
    API->>DB: UPDATE status = 'draft' (ìë™ ì „ì´)
    API->>DB: UPDATE title, description, videoSources
    DB-->>API: ìˆ˜ì • ì™„ë£Œ
    API-->>Admin: 200 OK (DRAFT)

    Note over Admin,User: âŒ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œ ì¤‘ë‹¨
    User->>API: GET /api/public/video-galleries
    API->>DB: SELECT WHERE status='opened' AND isPublic=true
    DB-->>API: í•´ë‹¹ ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì œì™¸
    API-->>User: 200 OK (ë…¸ì¶œ ì•ˆ ë¨)

    Note over Admin,User: ìˆ˜ì • â†’ ê²€í†  â†’ ìŠ¹ì¸ â†’ ì¬ê³µê°œ
    Admin->>API: PATCH /api/admin/video-galleries/:id/status
    Note right of API: under_review â†’ approved â†’ opened
    API->>DB: UPDATE status
    DB-->>API: ìƒíƒœ ë³€ê²½ ì™„ë£Œ
    API-->>Admin: 200 OK (OPENED)

    Note over Admin,User: âœ… ì‚¬ìš©ìì—ê²Œ ë‹¤ì‹œ ë…¸ì¶œë¨
```

## ğŸ¯ API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ëª…ì„¸

### 1. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„± âœ…

```
POST /api/admin/video-galleries
Content-Type: multipart/form-data

Body:
- title: string (í•„ìˆ˜, ì œëª©)
- description: string (ì„ íƒ, ì„¤ëª…)
- youtubeUrls: JSON string (ì„ íƒ, YouTube URL ë°°ì—´)
  ì˜ˆ: '["https://www.youtube.com/watch?v=abc123"]'
- files: ë¹„ë””ì˜¤ íŒŒì¼ ë°°ì—´ (MP4/MPEG/MOV/AVI/WMV/WEBM)

Response: 201 Created
- status: 'draft' (ê¸°ë³¸ê°’)
- isPublic: false (ê¸°ë³¸ê°’)
- videoSources: [{url, type: 'upload' | 'youtube', title?, thumbnailUrl?}]
```

### 2. ìƒíƒœ ë³€ê²½ (êµ¬í˜„ í•„ìš”) âŒ

```
PATCH /api/admin/video-galleries/:id/status

Body:
{
  "status": "under_review" | "approved" | "rejected" | "opened" | "draft"
}

Response: 200 OK
- ë³€ê²½ëœ ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì •ë³´
```

### 3. ê³µê°œ ì—¬ë¶€ ë³€ê²½ âœ…

```
PATCH /api/admin/video-galleries/:id/public

Body:
{
  "isPublic": true | false
}

Response: 200 OK
- ë³€ê²½ëœ ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì •ë³´
```

### 4. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìˆ˜ì • âœ…

```
PUT /api/admin/video-galleries/:id
Content-Type: multipart/form-data

Body:
- title: string (í•„ìˆ˜, ì œëª©)
- description: string (ì„ íƒ, ì„¤ëª…)
- youtubeUrls: JSON string (ì„ íƒ, YouTube URL ë°°ì—´)
- files: ë¹„ë””ì˜¤ íŒŒì¼ ë°°ì—´ (ì „ì†¡í•œ ê²ƒìœ¼ë¡œ ì™„ì „íˆ êµì²´)

Response: 200 OK
- statusê°€ 'opened'ì˜€ë‹¤ë©´ ìë™ìœ¼ë¡œ 'draft'ë¡œ ì „ì´ (êµ¬í˜„ í•„ìš”)
```

### 5. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì‚­ì œ (Soft Delete) âœ…

```
DELETE /api/admin/video-galleries/:id

Response: 200 OK
{
  "success": true
}
```

### 6. ì •ë ¬ ìˆœì„œ ì¼ê´„ ìˆ˜ì • âœ…

```
PUT /api/admin/video-galleries/batch-order

Body:
{
  "videoGalleries": [
    { "id": "uuid1", "order": 1 },
    { "id": "uuid2", "order": 2 }
  ]
}

Response: 200 OK
{
  "success": true,
  "updatedCount": 2
}
```

### 7. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•) âœ…

```
GET /api/admin/video-galleries?isPublic=true&orderBy=order&page=1&limit=10

Response: 200 OK
{
  "items": [...],
  "total": 50,
  "page": 1,
  "limit": 10,
  "totalPages": 5
}
```

### 8. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì „ì²´ ëª©ë¡ ì¡°íšŒ âœ…

```
GET /api/admin/video-galleries/all

Response: 200 OK
[...ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ë°°ì—´...]
```

### 9. ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„¸ ì¡°íšŒ âœ…

```
GET /api/admin/video-galleries/:id

Response: 200 OK
{
  "id": "uuid",
  "title": "íšŒì‚¬ ì†Œê°œ ì˜ìƒ",
  "description": "ì„¤ëª…...",
  "status": "draft",
  "isPublic": false,
  "order": 0,
  "videoSources": [
    {
      "url": "https://www.youtube.com/watch?v=abc123",
      "type": "youtube",
      "title": "YouTube ì œëª©"
    },
    {
      "url": "https://s3.amazonaws.com/video.mp4",
      "type": "upload",
      "title": "video.mp4"
    }
  ],
  ...
}
```

### 10. ì¹´í…Œê³ ë¦¬ ê´€ë ¨ API âœ…

```
GET /api/admin/video-galleries/categories
POST /api/admin/video-galleries/categories
PATCH /api/admin/video-galleries/categories/:id
PATCH /api/admin/video-galleries/categories/:id/order
DELETE /api/admin/video-galleries/categories/:id
```

## ğŸ”“ ê³µê°œ ì¡°ê±´ í”Œë¡œìš°

```mermaid
flowchart TD
    Start([ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ API ìš”ì²­])
    Start --> CheckAPI{API íƒ€ì…?}

    CheckAPI -->|ê´€ë¦¬ì API| AdminAPI[ì „ì²´ ì¡°íšŒ ê°€ëŠ¥]
    CheckAPI -->|ê³µê°œ API| PublicAPI[í•„í„°ë§ í•„ìš”]

    PublicAPI --> CheckDeleted{deletedAtì´ nullì¸ê°€?}

    CheckDeleted -->|No| NotVisible1[âŒ ë…¸ì¶œ ì•ˆ ë¨]
    CheckDeleted -->|Yes| CheckStatus{statusê°€ openedì¸ê°€?}

    CheckStatus -->|No| NotVisible2[âŒ ë…¸ì¶œ ì•ˆ ë¨]
    CheckStatus -->|Yes| CheckPublic{isPublicì´ trueì¸ê°€?}

    CheckPublic -->|No| NotVisible3[âŒ ë…¸ì¶œ ì•ˆ ë¨]
    CheckPublic -->|Yes| Visible[âœ… ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë¨]

    style NotVisible1 fill:#ffcccc
    style NotVisible2 fill:#ffcccc
    style NotVisible3 fill:#ffcccc
    style Visible fill:#ccffcc
    style AdminAPI fill:#e3f2fd
```

## ğŸ“‹ ìƒíƒœ ì „ì´ ê·œì¹™ ìš”ì•½

### í—ˆìš©ë˜ëŠ” ì „ì´

| í˜„ì¬ ìƒíƒœ      | ë‹¤ìŒ ìƒíƒœ      | API ì—”ë“œí¬ì¸íŠ¸                                   | ì¡°ê±´        | êµ¬í˜„ ìƒíƒœ |
| -------------- | -------------- | ------------------------------------------------ | ----------- | --------- |
| `draft`        | `under_review` | `PATCH /api/admin/video-galleries/:id/status`    | ê²€í†  ìš”ì²­   | âŒ        |
| `under_review` | `approved`     | `PATCH /api/admin/video-galleries/:id/status`    | ìŠ¹ì¸        | âŒ        |
| `under_review` | `rejected`     | `PATCH /api/admin/video-galleries/:id/status`    | ê±°ë¶€        | âŒ        |
| `under_review` | `draft`        | `PATCH /api/admin/video-galleries/:id/status`    | ê²€í†  ì·¨ì†Œ   | âŒ        |
| `approved`     | `opened`       | `PATCH /api/admin/video-galleries/:id/status`    | ê³µê°œ ì„¤ì •   | âŒ        |
| `approved`     | `draft`        | `PUT /api/admin/video-galleries/:id` (ìë™ ì „ì´) | ìˆ˜ì • ì‹œì‘   | âŒ        |
| `rejected`     | `draft`        | `PATCH /api/admin/video-galleries/:id/status`    | ìˆ˜ì • ì‹œì‘   | âŒ        |
| `opened`       | `draft`        | `PUT /api/admin/video-galleries/:id` (ìë™ ì „ì´) | ìˆ˜ì • ì‹œì‘   | âŒ        |
| `opened`       | `opened`       | `PATCH /api/admin/video-galleries/:id/public`    | ë¹„ê³µê°œ ì„¤ì • | âœ…        |

### ê¸ˆì§€ë˜ëŠ” ì „ì´

- âŒ `draft` â†’ `approved` (ê²€í†  ì—†ì´ ìŠ¹ì¸ ë¶ˆê°€)
- âŒ `draft` â†’ `opened` (ê²€í†  ë° ìŠ¹ì¸ ì—†ì´ ê³µê°œ ë¶ˆê°€)
- âŒ `rejected` â†’ `approved` (ê±°ë¶€ í›„ ë°”ë¡œ ìŠ¹ì¸ ë¶ˆê°€)
- âŒ `rejected` â†’ `opened` (ê±°ë¶€ëœ ì½˜í…ì¸  ê³µê°œ ë¶ˆê°€)
- âŒ `under_review` â†’ `opened` (ê²€í†  ì¤‘ ê³µê°œ ë¶ˆê°€)

## ğŸ”§ êµ¬í˜„ í•„ìš” ì‚¬í•­

### í˜„ì¬ êµ¬í˜„ëœ ê¸°ëŠ¥ âœ…

- âœ… ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„± (ê¸°ë³¸ê°’: `status: 'draft'`)
- âœ… ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•)
- âœ… ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì „ì²´ ëª©ë¡ ì¡°íšŒ
- âœ… ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìƒì„¸ ì¡°íšŒ
- âœ… ê³µê°œ ì—¬ë¶€ ìˆ˜ì • (`isPublic`)
- âœ… ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ìˆ˜ì • (ë‚´ìš© ë° ë¹„ë””ì˜¤ ì†ŒìŠ¤)
- âœ… ì •ë ¬ ìˆœì„œ ì¼ê´„ ìˆ˜ì •
- âœ… ì‚­ì œ (Soft Delete)
- âœ… ì¹´í…Œê³ ë¦¬ CRUD
- âœ… í•˜ì´ë¸Œë¦¬ë“œ ë¹„ë””ì˜¤ ì†ŒìŠ¤ (ì—…ë¡œë“œ + YouTube URL)

### êµ¬í˜„ í•„ìš” ê¸°ëŠ¥ âŒ

- âš ï¸ **ìƒíƒœ ë³€ê²½ API** (`PATCH /api/admin/video-galleries/:id/status`)
  - ìƒíƒœ ì „ì´ ê²€ì¦ ë¡œì§
  - í—ˆìš©ë˜ì§€ ì•ŠëŠ” ìƒíƒœ ì „ì´ ë°©ì§€
  - ìƒíƒœë³„ ì•¡ì…˜ ì œí•œ ê²€ì¦

- âš ï¸ **ìë™ ìƒíƒœ ì „ì´**
  - `opened` ë˜ëŠ” `approved` ìƒíƒœì—ì„œ ë‚´ìš© ìˆ˜ì • ì‹œ ìë™ìœ¼ë¡œ `draft`ë¡œ ì „ì´
  - íŠ¸ëœì­ì…˜ ì²˜ë¦¬ í•„ìš”

- âš ï¸ **ìƒíƒœë³„ ê¶Œí•œ ì²´í¬**
  - ê²€í† ì¤‘ ìƒíƒœì—ì„œëŠ” ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€
  - ìŠ¹ì¸ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥

## ğŸ“š ì°¸ê³  ì‚¬í•­

- ìƒíƒœ ë³€ê²½ì€ **ì›ìì (Atomic)**ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ì•¼ í•¨
- ìƒíƒœ ì „ì´ ì‹œ **ì´ë ¥ ë¡œê¹…** ê³ ë ¤ (ì„ íƒì‚¬í•­)
- **Optimistic Locking** (`version` í•„ë“œ)ì„ í™œìš©í•˜ì—¬ ë™ì‹œ ìˆ˜ì • ë°©ì§€
- ìƒíƒœë³„ **ê¶Œí•œ ì²´í¬** í•„ìš” (ì˜ˆ: ìŠ¹ì¸ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥)

## ğŸ¨ ë‹¤êµ­ì–´ ì „ëµ

ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ëŠ” **ë‹¤êµ­ì–´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ë‹¨ì¼ ì–¸ì–´(í•œêµ­ì–´)ë¡œë§Œ ì‘ì„±ë˜ë©°, ì œëª©(title)ê³¼ ì„¤ëª…(description)ì´ ì§ì ‘ ì—”í‹°í‹°ì— ì €ì¥ë©ë‹ˆë‹¤.

## ğŸ¬ ë¹„ë””ì˜¤ ì†ŒìŠ¤ ê´€ë¦¬ ì „ëµ

ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ëŠ” **í•˜ì´ë¸Œë¦¬ë“œ ë¹„ë””ì˜¤ ì†ŒìŠ¤ ê´€ë¦¬**ë¥¼ ì§€ì›í•©ë‹ˆë‹¤:

### ë¹„ë””ì˜¤ ì†ŒìŠ¤ íƒ€ì…

```typescript
type VideoSource = {
  url: string; // ë¹„ë””ì˜¤ URL (S3 ë˜ëŠ” YouTube)
  type: 'upload' | 'youtube'; // ì†ŒìŠ¤ íƒ€ì…
  title?: string; // ë¹„ë””ì˜¤ ì œëª© (ì„ íƒ)
  thumbnailUrl?: string; // ì¸ë„¤ì¼ URL (ì„ íƒ)
};
```

### ë¹„ë””ì˜¤ ì†ŒìŠ¤ ê´€ë¦¬ í”Œë¡œìš°

```mermaid
flowchart TD
    Start([ë¹„ë””ì˜¤ ì†ŒìŠ¤ ê´€ë¦¬])
    Start --> Upload{ì—…ë¡œë“œ íŒŒì¼ ìˆìŒ?}

    Upload -->|Yes| UploadS3[S3ì— ë¹„ë””ì˜¤ ì—…ë¡œë“œ]
    Upload -->|No| CheckYT[YouTube URL í™•ì¸]

    UploadS3 --> CreateUploadSource[type: 'upload'<br/>url: S3 URL<br/>title: íŒŒì¼ëª…]

    CheckYT --> YouTube{YouTube URL ìˆìŒ?}
    YouTube -->|Yes| CreateYTSource[type: 'youtube'<br/>url: YouTube URL]
    YouTube -->|No| Empty[ë¹ˆ ë°°ì—´]

    CreateUploadSource --> Merge[videoSources ë°°ì—´ í†µí•©]
    CreateYTSource --> Merge
    Empty --> Merge

    Merge --> Save[DBì— JSONBë¡œ ì €ì¥]

    style CreateUploadSource fill:#c8e6c9
    style CreateYTSource fill:#fff9c4
    style Merge fill:#e1bee7
```

### ë¹„ë””ì˜¤ ìˆ˜ì • ì‹œ ì²˜ë¦¬ ë°©ì‹

1. **ê¸°ì¡´ ì—…ë¡œë“œ ë¹„ë””ì˜¤ ì‚­ì œ**: S3ì—ì„œ type='upload'ì¸ ë¹„ë””ì˜¤ íŒŒì¼ë“¤ ì‚­ì œ
2. **YouTube URL ì œê±°**: ê¸°ì¡´ YouTube URLë„ ëª¨ë‘ ì œê±° (ì¬ì…ë ¥ í•„ìš”)
3. **ìƒˆ ë¹„ë””ì˜¤ ì—…ë¡œë“œ**: ìƒˆë¡œìš´ ë¹„ë””ì˜¤ íŒŒì¼ë“¤ì„ S3ì— ì—…ë¡œë“œ
4. **ìƒˆ YouTube URL ì¶”ê°€**: ìƒˆë¡œìš´ YouTube URLë“¤ ì¶”ê°€
5. **í†µí•© ì €ì¥**: ì—…ë¡œë“œëœ ë¹„ë””ì˜¤ì™€ YouTube URLì„ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ í†µí•©í•˜ì—¬ ì €ì¥

## ğŸ“¹ ë¹„ë””ì˜¤ íŒŒì¼ ê´€ë¦¬ ì „ëµ

### ì§€ì› í˜•ì‹

- **MP4** (video/mp4)
- **MPEG** (video/mpeg)
- **MOV** (video/quicktime)
- **AVI** (video/x-msvideo)
- **WMV** (video/x-ms-wmv)
- **WEBM** (video/webm)

### ì €ì¥ ë°©ì‹

1. **ì—…ë¡œë“œ íŒŒì¼**: AWS S3ì— ì—…ë¡œë“œë˜ë©° URLë¡œ ì €ì¥
2. **YouTube ë§í¬**: URL ê·¸ëŒ€ë¡œ ì €ì¥
3. **í†µí•© ê´€ë¦¬**: videoSources JSONB ë°°ì—´ì— íƒ€ì… êµ¬ë¶„í•˜ì—¬ ì €ì¥

## ğŸ¥ ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ì˜ íŠ¹ì§•

ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ëŠ” ë¹„ë””ì˜¤ ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì´ ìˆìŠµë‹ˆë‹¤:

| íŠ¹ì§•            | ì„¤ëª…                                          |
| --------------- | --------------------------------------------- |
| **ëŒ€ìƒ**        | ì¼ë°˜ ì‚¬ìš©ì (íšŒì‚¬ ì†Œê°œ, í™ë³´ ì˜ìƒ ë“±)         |
| **ë‹¤êµ­ì–´ ì§€ì›** | âŒ ë¯¸ì§€ì› (ë‹¨ì¼ ì–¸ì–´ë§Œ ì‚¬ìš©)                  |
| **ë¹„ë””ì˜¤ ì†ŒìŠ¤** | âœ… í•˜ì´ë¸Œë¦¬ë“œ (ì—…ë¡œë“œ + YouTube URL)          |
| **íŒŒì¼ í˜•ì‹**   | ë¹„ë””ì˜¤ íŒŒì¼ (MP4, MPEG, MOV, AVI, WMV, WEBM)  |
| **ì¹´í…Œê³ ë¦¬**    | âœ… ì§€ì› (íšŒì‚¬ ì†Œê°œ, ì œí’ˆ ì†Œê°œ, ì´ë²¤íŠ¸ ë“±)     |
| **ì •ë ¬**        | order(ì •ë ¬ìˆœì„œ) ë˜ëŠ” createdAt(ìƒì„±ì¼ì‹œ) ê¸°ì¤€ |
| **CQRS íŒ¨í„´**   | âœ… ì‚¬ìš© (CommandBus/QueryBus)                 |

## ğŸ†š ë‹¤ë¥¸ ì½˜í…ì¸  ì—”í‹°í‹°ì™€ì˜ ë¹„êµ

| íŠ¹ì§•            | ë£¨ë¯¸ë¥´ìŠ¤í† ë¦¬      | ë‰´ìŠ¤            | ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬                |
| --------------- | ----------------- | --------------- | --------------------------- |
| ë‹¤êµ­ì–´ ì§€ì›     | âŒ ë¯¸ì§€ì›         | âŒ ë¯¸ì§€ì›       | âŒ ë¯¸ì§€ì›                   |
| ì™¸ë¶€ ë§í¬ (URL) | âŒ ì—†ìŒ           | âœ… url í•„ë“œ     | âœ… YouTube URL ì§€ì›         |
| íŒŒì¼ í˜•ì‹       | PDF/ì´ë¯¸ì§€        | PDF/ì´ë¯¸ì§€      | ë¹„ë””ì˜¤ íŒŒì¼ (MP4 ë“±)        |
| ì¸ë„¤ì¼ ì´ë¯¸ì§€   | âœ… imageUrl       | âŒ ì—†ìŒ         | âŒ ì—†ìŒ (thumbnailUrl ì„ íƒ) |
| íŠ¹ìˆ˜ í•„ë“œ       | content (ê¸´ ë‚´ìš©) | url (ì™¸ë¶€ ë§í¬) | videoSources (í•˜ì´ë¸Œë¦¬ë“œ)   |
| ëŒ€ìƒ            | íšŒì‚¬ ìŠ¤í† ë¦¬       | ì–¸ë¡  ë³´ë„       | ë¹„ë””ì˜¤ ì½˜í…ì¸                |
| CQRS íŒ¨í„´       | âœ… ì‚¬ìš©           | âœ… ì‚¬ìš©         | âœ… ì‚¬ìš©                     |

## ğŸ“„ ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ ì—”í‹°í‹° êµ¬ì¡°

### ì£¼ìš” í•„ë“œ

- **title**: ë¹„ë””ì˜¤ ì œëª© (í•„ìˆ˜, varchar 500)
- **description**: ë¹„ë””ì˜¤ ì„¤ëª… (ì„ íƒ, text)
- **status**: ì½˜í…ì¸  ìƒíƒœ (enum)
- **isPublic**: ê³µê°œ ì—¬ë¶€ (boolean)
- **videoSources**: ë¹„ë””ì˜¤ ì†ŒìŠ¤ ëª©ë¡ (jsonb)
  - url: ë¹„ë””ì˜¤ URL
  - type: 'upload' | 'youtube'
  - title?: ë¹„ë””ì˜¤ ì œëª© (ì„ íƒ)
  - thumbnailUrl?: ì¸ë„¤ì¼ URL (ì„ íƒ)
- **order**: ì •ë ¬ ìˆœì„œ (int)

### ë¹„ë””ì˜¤ê°¤ëŸ¬ë¦¬ë§Œì˜ íŠ¹ì§•

- **í•˜ì´ë¸Œë¦¬ë“œ ë¹„ë””ì˜¤ ì†ŒìŠ¤**: ì—…ë¡œë“œ íŒŒì¼ê³¼ YouTube URLì„ ëª¨ë‘ ì§€ì›
- **ë¹„ë””ì˜¤ íŒŒì¼ í˜•ì‹**: ë‹¤ì–‘í•œ ë¹„ë””ì˜¤ í˜•ì‹ ì§€ì› (MP4, MPEG, MOV ë“±)
- **videoSources ë°°ì—´**: ì—¬ëŸ¬ ê°œì˜ ë¹„ë””ì˜¤ë¥¼ í•˜ë‚˜ì˜ ê°¤ëŸ¬ë¦¬ì— ì €ì¥
- **íƒ€ì… êµ¬ë¶„**: upload(ì—…ë¡œë“œ)ì™€ youtube(ì™¸ë¶€ë§í¬) íƒ€ì…ìœ¼ë¡œ êµ¬ë¶„ ê´€ë¦¬

## ğŸ¬ ë¹„ë””ì˜¤ ì†ŒìŠ¤ í™œìš© ì˜ˆì‹œ

### ìƒì„±/ìˆ˜ì • ì‹œ ì…ë ¥ ë°ì´í„°

```json
{
  "title": "íšŒì‚¬ ì†Œê°œ ì˜ìƒ ëª¨ìŒ",
  "description": "ë£¨ë¯¸ë¥´ íšŒì‚¬ ì†Œê°œ ì˜ìƒì…ë‹ˆë‹¤.",
  "youtubeUrls": [
    "https://www.youtube.com/watch?v=abc123",
    "https://www.youtube.com/watch?v=def456"
  ],
  "files": [ë¹„ë””ì˜¤íŒŒì¼1.mp4, ë¹„ë””ì˜¤íŒŒì¼2.mov]
}
```

### ì €ì¥ëœ videoSources êµ¬ì¡°

```json
{
  "videoSources": [
    {
      "url": "https://s3.amazonaws.com/video-galleries/ë¹„ë””ì˜¤íŒŒì¼1.mp4",
      "type": "upload",
      "title": "ë¹„ë””ì˜¤íŒŒì¼1.mp4"
    },
    {
      "url": "https://s3.amazonaws.com/video-galleries/ë¹„ë””ì˜¤íŒŒì¼2.mov",
      "type": "upload",
      "title": "ë¹„ë””ì˜¤íŒŒì¼2.mov"
    },
    {
      "url": "https://www.youtube.com/watch?v=abc123",
      "type": "youtube"
    },
    {
      "url": "https://www.youtube.com/watch?v=def456",
      "type": "youtube"
    }
  ]
}
```
